---
title: 'analize_2'
format:
  pdf:
    toc: true
    number-sections: true
    colorlinks: true
    fig-width: 12
    fig-height: 5
---

# Duomenu analize

```{r message = FALSE, warning=FALSE, echo=FALSE}
library(tidyverse)
library(readxl)
library(gmodels)
library(rstatix)
library(RVAideMemoire)
library(EnvStats)
library(ggpubr)
library(ggstatsplot)
library(statsExpressions)
```

```{r message = FALSE, warning=FALSE, echo=FALSE}
theme_set(theme_bw()+
            theme(panel.grid = element_blank(),
                  title = element_text(color = 'black',
                                       face='bold')))
```

```{r echo=FALSE}
library(readxl)
stats_new <- read_excel("stats_new.xlsx")
```

```{r echo=FALSE}

stats_mod <- stats_new

analize = stats_new[c('Lytis', 'Amzius', 'Atvykimo glu', 'Atv RITS glu','Dexametazonas', 'RITS valandos', 'Lovadieniai', 'Exitus RITS','SAPS', 'SOFA', 'APACHEII', 'ISARIC4C','Poliligotumas','CD','LILGFG60', 'PaO2FiO2', 'DPV10', 'PIT', 'Vazopresoriai10', 'DPVval', 'NIV10', 'NIVval', 'HF10', 'HFval', 'ECMO10', 'ECMOd', 'AtjungtasnuoECMO', 'PIT val')]

colnames(analize) <- c('Lytis', 'Amzius', 'Atvykimo_glu', 'Atv_RITS_glu','Dexametazonas', 'RITS_valandos', 'Lovadieniai', 'Exitus_RITS','SAPS', 'SOFA', 'APACHEII', 'ISARIC4C','Poliligotumas','CD','LILGFG60', 'PaO2FiO2', 'DPV10', 'PIT', 'Vazopresoriai10','DPVval', 'NIV10', 'NIVval', 'HF10', 'HFval', 'ECMO10', 'ECMOd', 'AtjungtasnuoECMO', 'PITval')

analize$PaO2FiO2 <- as.numeric(analize$PaO2FiO2)

analize_nona <- analize

analize_nona <- analize_nona %>%
  mutate(glu_fac = ifelse(Atvykimo_glu <= 5.55, '≤5.55', '5.56-9.99')) %>%
  mutate(glu_fac = ifelse(Atvykimo_glu >= 10, '≥10', glu_fac)) %>%
  mutate(glu_fac = factor(glu_fac, levels = c('≤5.55','5.56-9.99','≥10'))) %>%
  mutate(RITS_glu_fac = ifelse(Atv_RITS_glu <= 5.55, '≤5.55', '5.56-9.99')) %>%
  mutate(RITS_glu_fac = ifelse(Atv_RITS_glu >= 10, '≥10', RITS_glu_fac)) %>%
  mutate(RITS_glu_fac = factor(RITS_glu_fac, levels = c('≤5.55','5.56-9.99','≥10')))

analize_nona_f <- analize_nona
analize_nona_f[c(1,5,8,13,14,15,17,18,19,21,23,25,27)] <- lapply(analize_nona_f[c(1,5,8,13,14,15,17,18,19,21,23,25,27)], factor)

levels(analize_nona_f$Exitus_RITS) <- c('išgyveno', 'mirė')
levels(analize_nona_f$DPV10) <- c('netaikyta', 'taikyta')
levels(analize_nona_f$HF10) <- c('netaikyta', 'taikyta')
levels(analize_nona_f$NIV10) <- c('netaikyta', 'taikyta')
levels(analize_nona_f$Vazopresoriai10) <- c('netaikyta', 'taikyta')
levels(analize_nona_f$ECMO10) <- c('netaikyta', 'taikyta')
levels(analize_nona_f$AtjungtasnuoECMO) <- c('neatjungta', 'atjungta')
levels(analize_nona_f$PIT) <- c('netaikyta', 'taikyta')

```

## Glikemijos verčių ir mirštamumo vertinimas

```{r echo=FALSE, message=FALSE, output=FALSE}
g1 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=Exitus_RITS,
  y=glu_fac,
  grouping.var = CD,
  legend.title= 'Mirštamumas',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'Mirštamumas: Atvykimo gliukozė'
  ),
  # ggplot.component = list(theme(axis.text.x = ggplot2::element_text(angle = 60)))
)

g2 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=Exitus_RITS,
  y=RITS_glu_fac,
  grouping.var = CD,
  legend.title= 'Mirštamumas',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'Mirštamumas: RITS gliukozė'
  )
)


g1[[1]]$labels$subtitle

g1[[2]]$labels$subtitle

g2[[1]]$labels$subtitle

g2[[2]]$labels$subtitle

g1[[1]] <- g1[[1]]+
  labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "12.46", italic(p) < "0.001")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g1[[2]] <- g1[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "0.30", italic(p) == "0.86")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")

g2[[1]] <- g2[[1]]+
  labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "12.35", italic(p) == "0.001")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g2[[2]] <- g2[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "4.52", italic(p) == "0.10")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")

```

```{r echo=FALSE, message=FALSE, warning=FALSE}
plot1 <- ggarrange(g1, g2, ncol=2, nrow=1, common.legend = TRUE, legend='right')
plot1+
  labs(tag = 'mmol/l')+
  theme(plot.tag = element_text(size = 10, colour = 'grey30', face = 'plain'),
        plot.tag.position = c(0.89,0.055))

ggsave('glu_exit.png', width = 12, height = 5, bg='white')
```

## Glikemijos verčių ir hospitalizacijos trukmės vertinimas

Grupinis

```{r echo=FALSE, message=FALSE, output=FALSE}
anno_df = compare_means(RITS_valandos ~ glu_fac, group.by = "CD", data = analize_nona_f) %>%
 mutate(y_pos = 2200)

my_comp = list(
  c('≤5.55','5.56-9.99'), 
  c('≤5.55','≥10'), 
  c('5.56-9.99','≥10')
)

variable_names <- list(
  "0" = "Be CD" ,
  "1" = "CD"
)

variable_labeller <- function(variable,value){
  return(variable_names[value])
}

p1 <- analize_nona_f %>%
  select(CD, RITS_valandos, glu_fac) %>%
  mutate(CD = factor(CD, levels = c('1', '0'))) %>%
  group_by(CD, glu_fac) %>%
  ggplot(aes(glu_fac, RITS_valandos, fill=glu_fac))+
  geom_boxplot()+
  # ggboxplot(x='glu_fac', y='RITS_valandos', fill='glu_fac')+
  # ggplot(aes(glu_fac, RITS_valandos, color=glu_fac))+
  # geom_boxplot(position=position_dodge())+
  # geom_point(aes(color=glu_fac), position_jitterdodge())
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(comparisons = my_comp, method = 't.test')+
  # stat_compare_means()+
  labs(x='Atvykimo\ngliukoze',
       fill = NULL,
       y=NULL)+
  # scale_fill_grey(breaks = c('high', 'medium', 'low'))+
  scale_fill_discrete(breaks = c('≥10', '5.56-9.99', '≤5.55'))+
  coord_flip()


p2 <- analize_nona_f %>%
  select(CD, RITS_valandos, RITS_glu_fac) %>%
  mutate(CD = factor(CD, levels = c('1', '0'))) %>%
  group_by(CD, RITS_glu_fac) %>%
  ggplot(aes(RITS_glu_fac, RITS_valandos, fill=RITS_glu_fac))+
  geom_boxplot()+
  ylim(0,2500)+
  # ggboxplot(x='glu_fac', y='RITS_valandos', fill='glu_fac')+
  # ggplot(aes(glu_fac, RITS_valandos, color=glu_fac))+
  # geom_boxplot(position=position_dodge())+
  # geom_point(aes(color=glu_fac), position_jitterdodge())
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(comparisons = my_comp, method = 't.test')+
  # stat_compare_means()+
  labs(x='Atvykimo\ngliukoze',
       fill = NULL,
       y=NULL)+
  # scale_fill_grey(breaks = c('high', 'medium', 'low'))+
  scale_fill_discrete(breaks = c('high', 'medium', 'low'))+
  coord_flip()

ggarrange(p1, p2, ncol=1, nrow=2, common.legend = TRUE, legend = 'bottom')
```

Bendras

RITS_valandos

```{r echo=FALSE, warning=FALSE}
theme_set(theme_bw()+
            labs_pubr()+
            theme(panel.grid = element_blank()))

variable_names <- list(
  "0" = "Be CD" ,
  "1" = "CD"
)

variable_labeller <- function(variable,value){
  return(variable_names[value])
}

p1 <- analize_nona_f %>%
  ggplot(aes(glu_fac, RITS_valandos, fill=glu_fac))+
  geom_boxplot()+
  ylim(0,2000)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 1500, label = 'p.format')+
  labs(x='Atvykimo\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank())


p2 <- analize_nona_f %>%
  ggplot(aes(RITS_glu_fac, RITS_valandos, fill=RITS_glu_fac))+
  geom_boxplot()+
  ylim(0,2000)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 1500, label = 'p.format')+
  labs(x='RITS\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(
    axis.text.y = element_blank(), 
    axis.ticks.y = element_blank()
  )

plot <- ggarrange(p1, p2, ncol=1, nrow=2, common.legend = TRUE, legend = 'bottom')+
  labs(tag = 'valandos')+
  theme(plot.tag = element_text(size = 12, colour = 'black', face = 'bold'),
        plot.tag.position = c(0.87,0.08))

annotate_figure(plot, top = text_grob("RITS_valandos", 
               color = "black", face = "bold", size = 14),)

ggsave('RITS_valandos.png', width=7, height = 5, bg='white')
```

Lovadieniai

```{r echo=FALSE, warning=FALSE}
p1 <- analize_nona_f %>%
  ggplot(aes(glu_fac, Lovadieniai, fill=glu_fac))+
  geom_boxplot()+
  ylim(0,190)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 150, label = 'p.format')+
  labs(x='Atvykimo\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank())


p2 <- analize_nona_f %>%
  ggplot(aes(RITS_glu_fac, Lovadieniai, fill=RITS_glu_fac))+
  geom_boxplot()+
  ylim(0,190)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 150, label = 'p.format')+
  labs(x='RITS\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(
    axis.text.y = element_blank(), 
    axis.ticks.y = element_blank()
  )

plot <- ggarrange(p1, p2, ncol=1, nrow=2, common.legend = TRUE, legend = 'bottom')+
  labs(tag = 'dienos')+
  theme(plot.tag = element_text(size = 12, colour = 'black', face = 'bold'),
        plot.tag.position = c(0.87,0.08))
plot
# annotate_figure(plot, top = text_grob("RITS_valandos", 
#                color = "black", face = "bold", size = 14),)

ggsave('lovadieniai.png', width=7, height = 5, bg='white')
```

## Glikemija ir prognozes skales

APACHEII

```{r echo=FALSE, warning=FALSE}
p1 <- analize_nona_f %>%
  ggplot(aes(glu_fac, APACHEII, fill=glu_fac))+
  geom_boxplot()+
  ylim(0,60)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 50, label = 'p.format')+
  labs(x='Atvykimo\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank())


p2 <- analize_nona_f %>%
  ggplot(aes(RITS_glu_fac, APACHEII, fill=RITS_glu_fac))+
  geom_boxplot()+
  ylim(0,60)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 50, label = 'p.format')+
  labs(x='RITS\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(
    axis.text.y = element_blank(), 
    axis.ticks.y = element_blank()
  )
plot <- ggarrange(p1, p2, ncol=1, nrow=2, common.legend = TRUE, legend = 'bottom')+
  labs(tag = 'balai')+
  theme(plot.tag = element_text(size = 12, colour = 'black', face = 'bold'),
        plot.tag.position = c(0.87,0.08))
plot
# annotate_figure(plot, top = text_grob("RITS_valandos", 
#                color = "black", face = "bold", size = 14),)


ggsave('APACHEII.png', width=7, height = 5, bg='white')
```

SAPS

```{r echo=FALSE, warning=FALSE}
p1 <- analize_nona_f %>%
  ggplot(aes(glu_fac, SAPS, fill=glu_fac))+
  geom_boxplot()+
  ylim(0,110)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 93, label = 'p.format')+
  labs(x='Atvykimo\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank())


p2 <- analize_nona_f %>%
  ggplot(aes(RITS_glu_fac, SAPS, fill=RITS_glu_fac))+
  geom_boxplot()+
  ylim(0,110)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 93, label = 'p.format')+
  labs(x='RITS\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(
    axis.text.y = element_blank(), 
    axis.ticks.y = element_blank()
    )

plot <- ggarrange(p1, p2, ncol=1, nrow=2, common.legend = TRUE, legend = 'bottom')+
  labs(tag = 'balai')+
  theme(plot.tag = element_text(size = 12, colour = 'black', face = 'bold'),
        plot.tag.position = c(0.87,0.08))
plot
# annotate_figure(plot, top = text_grob("RITS_valandos", 
#                color = "black", face = "bold", size = 14),)

ggsave('SAPS.png', width=7, height = 5, bg='white')
```

ISARIC 4C

```{r echo=FALSE, warning=FALSE}
p1 <- analize_nona_f %>%
  ggplot(aes(glu_fac, ISARIC4C, fill=glu_fac))+
  geom_boxplot()+
  ylim(0,26)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 23, label = 'p.format')+
  labs(x='Atvykimo\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank())


p2 <- analize_nona_f %>%
  ggplot(aes(RITS_glu_fac, ISARIC4C, fill=RITS_glu_fac))+
  geom_boxplot()+
  ylim(0,26)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 23, label = 'p.format')+
  labs(x='RITS\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(
    axis.text.y = element_blank(), 
    axis.ticks.y = element_blank()
    )

plot <- ggarrange(p1, p2, ncol=1, nrow=2, common.legend = TRUE, legend = 'bottom')+
  labs(tag = 'balai')+
  theme(plot.tag = element_text(size = 12, colour = 'black', face = 'bold'),
        plot.tag.position = c(0.87,0.08))
plot
# annotate_figure(plot, top = text_grob("RITS_valandos", 
#                color = "black", face = "bold", size = 14),)

ggsave('ISARIC4C.png', width=7, height = 5, bg='white')
```

SOFA

```{r echo=FALSE, warning=FALSE}
p1 <- analize_nona_f %>%
  ggplot(aes(glu_fac, SOFA, fill=glu_fac))+
  geom_boxplot()+
  ylim(0,26)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 23, label = 'p.format')+
  labs(x='Atvykimo\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank())


p2 <- analize_nona_f %>%
  ggplot(aes(RITS_glu_fac, SOFA, fill=RITS_glu_fac))+
  geom_boxplot()+
  ylim(0,26)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 23, label = 'p.format')+
  labs(x='RITS\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(
    axis.text.y = element_blank(), 
    axis.ticks.y = element_blank()
    )

plot <- ggarrange(p1, p2, ncol=1, nrow=2, common.legend = TRUE, legend = 'bottom')+
  labs(tag = 'balai')+
  theme(plot.tag = element_text(size = 12, colour = 'black', face = 'bold'),
        plot.tag.position = c(0.87,0.08))
plot
# annotate_figure(plot, top = text_grob("RITS_valandos", 
#                color = "black", face = "bold", size = 14),)

ggsave('SOFA.png', width=7, height = 5, bg='white')
```

## Hiperglikemija ir kvėpavimo funkcija

```{r echo=FALSE, warning=FALSE}
p1 <- analize_nona_f %>%
  ggplot(aes(glu_fac, PaO2FiO2, fill=glu_fac))+
  geom_boxplot()+
  ylim(0,780)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 680, label = 'p.format')+
  labs(x='Atvykimo\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank())


p2 <- analize_nona_f %>%
  ggplot(aes(RITS_glu_fac, PaO2FiO2, fill=RITS_glu_fac))+
  geom_boxplot()+
  ylim(0,780)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 680, label = 'p.format')+
  labs(x='RITS\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(
    axis.text.y = element_blank(), 
    axis.ticks.y = element_blank()
    )

plot <- ggarrange(p1, p2, ncol=1, nrow=2, common.legend = TRUE, legend = 'bottom')+
  labs(tag = 'mmHg')+
  theme(plot.tag = element_text(size = 12, colour = 'black', face = 'bold'),
        plot.tag.position = c(0.87,0.08))
plot

ggsave('PaO2FiO2.png', width=7, height = 5, bg='white')
```

## Hiperglikemija ir kvėpavimo funkcijos nepakankamumo gydymo būdai

DPV poreikis

```{r echo=FALSE, message=FALSE, output=FALSE}
g1 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=DPV10,
  y=glu_fac,
  grouping.var = CD,
  legend.title= 'DPV',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'DPV poreikis: Atvykimo gliukozė'
  ),
  # ggplot.component = list(theme(axis.text.x = ggplot2::element_text(angle = 60)))
)

g2 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=DPV10,
  y=RITS_glu_fac,
  grouping.var = CD,
  legend.title= 'DPV',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'DPV poreikis: RITS gliukozė'
  )
)
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[1]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[2]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[1]] <- g1[[1]]+
  labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "10.29", italic(p) < "0.001")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g1[[2]] <- g1[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "1.62", italic(p) == "0.56")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")

```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[1]]$labels$subtitle
```

```{r echo=FALSE, message = FALSE, output=FALSE}
g2[[2]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[1]] <- g2[[1]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "11.70", italic(p) == "0.001")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g2[[2]] <- g2[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "0.94", italic(p) == "0.61")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")

```

```{r echo=FALSE}
plot1 <- ggarrange(g1, g2, ncol=2, nrow=1, common.legend = TRUE, legend='right')
plot1+
  labs(tag = 'mmol/l')+
  theme(plot.tag = element_text(size = 10, colour = 'grey30', face = 'plain'),
        plot.tag.position = c(0.89,0.055))

ggsave('DPV.png', width = 12, height = 5, bg='white')
```

DPV valandos

```{r echo=FALSE, warning=FALSE}
p1 <- analize_nona_f %>%
  ggplot(aes(glu_fac, DPVval, fill=glu_fac))+
  geom_boxplot()+
  ylim(0,780)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 680, label = 'p.format')+
  labs(x='Atvykimo\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank())


p2 <- analize_nona_f %>%
  ggplot(aes(RITS_glu_fac, DPVval, fill=RITS_glu_fac))+
  geom_boxplot()+
  ylim(0,780)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 680, label = 'p.format')+
  labs(x='RITS\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(
    axis.text.y = element_blank(), 
    axis.ticks.y = element_blank()
    )

plot <- ggarrange(p1, p2, ncol=1, nrow=2, common.legend = TRUE, legend = 'bottom')+
  labs(tag = 'valandos')+
  theme(plot.tag = element_text(size = 12, colour = 'black', face = 'bold'),
        plot.tag.position = c(0.87,0.08))
plot


ggsave('DPVval.png', width=7, height = 5, bg='white')
```

HF poreikis

```{r echo=FALSE, message=FALSE, output=FALSE}
g1 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=HF10,
  y=glu_fac,
  grouping.var = CD,
  legend.title= 'HF',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'HF poreikis: Atvykimo gliukozė'
  ),
  # ggplot.component = list(theme(axis.text.x = ggplot2::element_text(angle = 60)))
)

g2 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=HF10,
  y=RITS_glu_fac,
  grouping.var = CD,
  legend.title= 'HF',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'HF poreikis: RITS gliukozė'
  )
)
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[1]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[2]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[1]] <- g1[[1]]+
  labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "3.16", italic(p) == "0.11")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g1[[2]] <- g1[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "4.15", italic(p) == "0.13")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[1]]$labels$subtitle
```

```{r echo=FALSE, message = FALSE, output=FALSE}
g2[[2]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[1]] <- g2[[1]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "8.58", italic(p) == "0.02")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g2[[2]] <- g2[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "8.13", italic(p) == "0.02")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")

```

```{r echo=FALSE}
plot1 <- ggarrange(g1, g2, ncol=2, nrow=1, common.legend = TRUE, legend='right')
plot1+
  labs(tag = 'mmol/l')+
  theme(plot.tag = element_text(size = 10, colour = 'grey30', face = 'plain'),
        plot.tag.position = c(0.89,0.055))

ggsave('HF.png', width = 12, height = 5, bg='white')
```

HF valandos

```{r echo=FALSE, warning=FALSE}
p1 <- analize_nona_f %>%
  ggplot(aes(glu_fac, HFval, fill=glu_fac))+
  geom_boxplot()+
  ylim(0,630)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 580, label = 'p.format')+
  labs(x='Atvykimo\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank())


p2 <- analize_nona_f %>%
  ggplot(aes(RITS_glu_fac, HFval, fill=RITS_glu_fac))+
  geom_boxplot()+
  ylim(0,630)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 580, label = 'p.format')+
  labs(x='RITS\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(
    axis.text.y = element_blank(), 
    axis.ticks.y = element_blank()
    )

plot <- ggarrange(p1, p2, ncol=1, nrow=2, common.legend = TRUE, legend = 'bottom')+
  labs(tag = 'valandos')+
  theme(plot.tag = element_text(size = 12, colour = 'black', face = 'bold'),
        plot.tag.position = c(0.87,0.08))
plot


ggsave('HFval.png', width=7, height = 5, bg='white')
```

NIV poreikis

```{r echo=FALSE, message=FALSE, output=FALSE}
g1 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=NIV10,
  y=glu_fac,
  grouping.var = CD,
  legend.title= 'NIV',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'NIV poreikis: Atvykimo gliukozė'
  ),
  # ggplot.component = list(theme(axis.text.x = ggplot2::element_text(angle = 60)))
)

g2 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=NIV10,
  y=RITS_glu_fac,
  grouping.var = CD,
  legend.title= 'NIV',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'NIV poreikis: RITS gliukozė'
  )
)
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[1]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[2]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[1]] <- g1[[1]]+
  labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "1.37", italic(p) == "0.59")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g1[[2]] <- g1[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "2.93", italic(p) == "0.23")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[1]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[2]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[1]] <- g2[[1]]+
  labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "8.96", italic(p) == "0.02")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g2[[2]] <- g2[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "2.56", italic(p) == "0.28")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")
```

```{r echo=FALSE}
plot1 <- ggarrange(g1, g2, ncol=2, nrow=1, common.legend = TRUE, legend='right')
plot1+
  labs(tag = 'mmol/l')+
  theme(plot.tag = element_text(size = 10, colour = 'grey30', face = 'plain'),
        plot.tag.position = c(0.89,0.055))

ggsave('NIV.png', width = 12, height = 5, bg='white')
```

NIV valandos

```{r echo=FALSE, warning=FALSE}
p1 <- analize_nona_f %>%
  ggplot(aes(glu_fac, NIVval, fill=glu_fac))+
  geom_boxplot()+
  ylim(0,60)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 50, label = 'p.format')+
  labs(x='Atvykimo\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank())


p2 <- analize_nona_f %>%
  ggplot(aes(RITS_glu_fac, NIVval, fill=RITS_glu_fac))+
  geom_boxplot()+
  ylim(0,60)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 50, label = 'p.format')+
  labs(x='RITS\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(
    axis.text.y = element_blank(), 
    axis.ticks.y = element_blank()
    )

plot <- ggarrange(p1, p2, ncol=1, nrow=2, common.legend = TRUE, legend = 'bottom')+
  labs(tag = 'valandos')+
  theme(plot.tag = element_text(size = 12, colour = 'black', face = 'bold'),
        plot.tag.position = c(0.87,0.08))
plot

ggsave('NIVval.png', width=7, height = 5, bg='white')
```

## Hiperglikemija ir kraujotakos palaikymo būdai

Vazopresoriu poreikis

```{r echo=FALSE, message=FALSE, output=FALSE}
g1 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=Vazopresoriai10,
  y=glu_fac,
  grouping.var = CD,
  legend.title= 'Vazopresoriai',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'Vazopresorių poreikis: Atvykimo gliukozė'
  ),
  # ggplot.component = list(theme(axis.text.x = ggplot2::element_text(angle = 60)))
)

g2 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=Vazopresoriai10,
  y=RITS_glu_fac,
  grouping.var = CD,
  legend.title= 'Vazopresoriai',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'Vazopresorių poreikis: RITS gliukozė'
  )
)
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[1]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[2]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[1]] <- g1[[1]]+
  labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "11.27", italic(p) == "0.001")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g1[[2]] <- g1[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "0.27", italic(p) == "0.88")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[1]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[2]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[1]] <- g2[[1]]+
  labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "13.54", italic(p) < "0.001")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g2[[2]] <- g2[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "0.19", italic(p) == "0.91")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")
```

```{r echo=FALSE}
plot1 <- ggarrange(g1, g2, ncol=2, nrow=1, common.legend = TRUE, legend='right')
plot1+
  labs(tag = 'mmol/l')+
  theme(plot.tag = element_text(size = 10, colour = 'grey30', face = 'plain'),
        plot.tag.position = c(0.89,0.055))

ggsave('Vazopresoriai.png', width = 12, height = 5, bg='white')
```

ECMO

```{r echo=FALSE, message=FALSE, output=FALSE}
g1 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=ECMO10,
  y=glu_fac,
  grouping.var = CD,
  legend.title= 'EKMO',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'EKMO poreikis: Atvykimo gliukozė'
  ),
  # ggplot.component = list(theme(axis.text.x = ggplot2::element_text(angle = 60)))
)

g2 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=ECMO10,
  y=RITS_glu_fac,
  grouping.var = CD,
  legend.title= 'EKMO',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'EKMO poreikis: RITS gliukozė'
  )
)
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[1]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[2]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[1]] <- g1[[1]]+
  labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "8.37", italic(p) == "0.03")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g1[[2]] <- g1[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "2.30", italic(p) == "0.32")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[1]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[2]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[1]] <- g2[[1]]+
  labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "4.54", italic(p) == "0.17")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g2[[2]] <- g2[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "0.69", italic(p) == "0.71")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")
```

```{r echo=FALSE}
plot1 <- ggarrange(g1, g2, ncol=2, nrow=1, common.legend = TRUE, legend='right')
plot1+
  labs(tag = 'mmol/l')+
  theme(plot.tag = element_text(size = 10, colour = 'grey30', face = 'plain'),
        plot.tag.position = c(0.89,0.055))

ggsave('EKMO.png', width = 12, height = 5, bg='white')
```

ECMO dienos

```{r echo=FALSE, warning=FALSE}
p1 <- analize_nona_f %>%
  ggplot(aes(glu_fac, ECMOd, fill=glu_fac))+
  geom_boxplot()+
  ylim(0,38)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 32, label = 'p.format')+
  labs(x='Atvykimo\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank())


p2 <- analize_nona_f %>%
  ggplot(aes(RITS_glu_fac, ECMOd, fill=RITS_glu_fac))+
  geom_boxplot()+
  ylim(0,38)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 32, label = 'p.format')+
  labs(x='RITS\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(
    axis.text.y = element_blank(), 
    axis.ticks.y = element_blank()
    )

plot <- ggarrange(p1, p2, ncol=1, nrow=2, common.legend = TRUE, legend = 'bottom')+
  labs(tag = 'dienos')+
  theme(plot.tag = element_text(size = 12, colour = 'black', face = 'bold'),
        plot.tag.position = c(0.87,0.08))
plot

ggsave('ECMO_dienos.png', width=7, height = 5, bg='white')
```

ECMO atjungta

```{r echo=FALSE, message=FALSE, output=FALSE}
g1 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=AtjungtasnuoECMO,
  y=glu_fac,
  grouping.var = CD,
  legend.title= 'EKMO atjungimas',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'EKMO atjungimas: Atvykimo gliukozė'
  ),
  # ggplot.component = list(theme(axis.text.x = ggplot2::element_text(angle = 60)))
)

g2 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=AtjungtasnuoECMO,
  y=RITS_glu_fac,
  grouping.var = CD,
  legend.title= 'EKMO atjungimas',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'EKMO atjungimas: RITS gliukozė'
  )
)
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[1]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[2]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[1]] <- g1[[1]]+
  labs(subtitle=ggplot2::expr(paste(
list(chi["Pearson"]^2 * "(" * 2 * ")" == "0.19", italic(p) == 
"0.91")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g1[[2]] <- g1[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 1 * ")" == "4.00", italic(p) == "0.05")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[1]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[2]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[1]] <- g2[[1]]+
  labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "0.19", italic(p) ==
"0.91")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g2[[2]] <- g2[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 1 * ")" == "0.44", italic(p) == "0.50")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")
```

```{r echo=FALSE}
plot1 <- ggarrange(g1, g2, ncol=2, nrow=1, common.legend = TRUE, legend='right')
plot1+
  labs(tag = 'mmol/l')+
  theme(plot.tag = element_text(size = 10, colour = 'grey30', face = 'plain'),
        plot.tag.position = c(0.89,0.055))

ggsave('EKMO_atjungta.png', width = 12, height = 5, bg='white')
```

## Hiperglikemija ir pakaitinė inkstų terapija

PIT

```{r echo=FALSE, message=FALSE, output=FALSE}
g1 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=PIT,
  y=glu_fac,
  grouping.var = CD,
  legend.title= 'PIT',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'PIT: Atvykimo gliukozė'
  ),
  # ggplot.component = list(theme(axis.text.x = ggplot2::element_text(angle = 60)))
)

g2 <- ggstatsplot::grouped_ggbarstats(
  data = analize_nona_f,
  x=PIT,
  y=RITS_glu_fac,
  grouping.var = CD,
  legend.title= 'PIT',
  proportion.test = NULL,
  ggtheme = theme_pubclean(),
  legend.position='none',
  bf.message=FALSE,
  palette = 'Set3',
  messages=FALSE,
  annotation.args = list(
    title = 'PIT: RITS gliukozė'
  )
)
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[1]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[2]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g1[[1]] <- g1[[1]]+
  labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "3.12", italic(p) == "0.25")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g1[[2]] <- g1[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "0.49", italic(p) == "0.78")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[1]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[2]]$labels$subtitle
```

```{r echo=FALSE, message=FALSE, output=FALSE}
g2[[1]] <- g2[[1]]+
  labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "4.38", italic(p) == "0.14")
)))+
  labs(caption=NULL, title='ne CD', xlab = NULL, x = NULL)+
  theme(legend.position="none")

g2[[2]] <- g2[[2]]+labs(subtitle=ggplot2::expr(paste(
  list(chi["Pearson"]^2 * "(" * 2 * ")" == "0.13", italic(p) == "0.94")
)))+
  labs(caption=NULL, title = "CD", xlab=NULL, x = NULL)+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  theme(legend.position="none")
```

```{r echo=FALSE}
plot1 <- ggarrange(g1, g2, ncol=2, nrow=1, common.legend = TRUE, legend='right')
plot1+
  labs(tag = 'mmol/l')+
  theme(plot.tag = element_text(size = 10, colour = 'grey30', face = 'plain'),
        plot.tag.position = c(0.89,0.055))

ggsave('PIT.png', width = 12, height = 5, bg='white')
```

PIT val

```{r echo=FALSE, warning=FALSE}
p1 <- analize_nona_f %>%
  filter(PITval > 0) %>%
  ggplot(aes(glu_fac, PITval, fill=glu_fac))+
  geom_boxplot()+
  ylim(0,62)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 54, label = 'p.format')+
  labs(x='Atvykimo\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank())


p2 <- analize_nona_f %>%
  filter(PITval > 0) %>%
  ggplot(aes(RITS_glu_fac, PITval, fill=RITS_glu_fac))+
  geom_boxplot()+
  ylim(0,62)+
  facet_wrap(~CD, labeller = variable_labeller, ncol = 1, strip.position = 'left')+
  stat_compare_means(label.x = '≤5.55', label.y = 54, label = 'p.format')+
  labs(x='RITS\ngliukoze',
       fill = NULL,
       y=NULL)+
  scale_fill_brewer(breaks = c('≥10', '5.56-9.99', '≤5.55'), palette="Set3", labels = c('≥10', '5.56-9.99', '≤5.55   mmol/l'))+
  coord_flip()+
  theme(
    axis.text.y = element_blank(), 
    axis.ticks.y = element_blank()
    )

plot <- ggarrange(p1, p2, ncol=1, nrow=2, common.legend = TRUE, legend = 'bottom')+
  labs(tag = 'valandos')+
  theme(plot.tag = element_text(size = 12, colour = 'black', face = 'bold'),
        plot.tag.position = c(0.87,0.08))
plot

ggsave('PIT_valandos.png', width=7, height = 5, bg='white')

```

## Logistinis modelis

```{r echo= FALSE, message=FALSE, warning=FALSE, output=FALSE}
library(caret)
library(glmnet)

analize_nona_model <- analize[c(1,2,3,8,9,10,11,12,13,14,16)]
analize_nona_model[c(1,4,9,10)] <- lapply(analize_nona_model[c(1,4,9,10)], factor)
analize_nona_model <- analize_nona_model[complete.cases(analize_nona_model),]
levels(analize_nona_model$Exitus_RITS) <- make.names(levels(analize_nona_model$Exitus_RITS))

analize_nona_model <- analize_nona_model %>%
  mutate(glu_fac = ifelse(Atvykimo_glu < 10, '<10', '≥10'))

analize_nona_model <- analize_nona_model %>%
  filter(CD == 0)

set.seed(90)
training.samples <- analize_nona_model$Exitus_RITS %>%
  createDataPartition(p=0.7, list=FALSE)

train.data = analize_nona_model[training.samples,]
test.data = analize_nona_model[-training.samples,]

# Define the training control
train_control <- trainControl(method="cv", number=5)

```

### SAPS

```{r echo= FALSE, message=FALSE, warning=FALSE}

model <- train(Exitus_RITS ~SAPS, data = analize_nona_model, method = "glm", 
               trControl = train_control, 
               family = "binomial")

predictions <- predict(model, newdata = analize_nona_model)

confusionMatrix(predictions,analize_nona_model$Exitus_RITS, mode = "prec_recall", positive = 'X1')

```

## SAPS + glu_fac

```{r echo= FALSE, message=FALSE, warning=FALSE}

model <- train(Exitus_RITS ~SAPS+ glu_fac, data = analize_nona_model, method = "glm", 
               trControl = train_control, 
               family = "binomial")

predictions <- predict(model, newdata = analize_nona_model)

confusionMatrix(predictions, analize_nona_model$Exitus_RITS, mode = "prec_recall", positive = 'X1')

```

## SOFA

```{r echo= FALSE, message=FALSE, warning=FALSE}

model <- train(Exitus_RITS ~ SOFA, data = analize_nona_model, method = "glm", 
               trControl = train_control, 
               family = "binomial")

predictions <- predict(model, newdata = analize_nona_model)

confusionMatrix(predictions, analize_nona_model$Exitus_RITS, mode = "prec_recall", positive = 'X1')


```

### ISARIC4C

```{r echo= FALSE, message=FALSE, warning=FALSE}

model <- train(Exitus_RITS ~ ISARIC4C, data = analize_nona_model, method = "glm", 
               trControl = train_control, 
               family = "binomial")

predictions <- predict(model, newdata = analize_nona_model)

confusionMatrix(predictions, analize_nona_model$Exitus_RITS, mode = "prec_recall", positive = 'X1')

```

## ISARIC4C + gliukoze 2 faktoriais

```{r echo= FALSE, message=FALSE, warning=FALSE}

model <- train(Exitus_RITS ~ ISARIC4C + glu_fac, data = analize_nona_model, method = "glm", 
               trControl = train_control, 
               family = "binomial")

predictions <- predict(model, newdata = analize_nona_model)

confusionMatrix(predictions, analize_nona_model$Exitus_RITS, mode = "prec_recall", positive = 'X1')

```

## APACHEII

```{r echo= FALSE, message=FALSE, warning=FALSE}

model <- train(Exitus_RITS ~ APACHEII, data = analize_nona_model, method = "glm", 
               trControl = train_control, 
               family = "binomial")

predictions <- predict(model, newdata = analize_nona_model)

confusionMatrix(predictions, analize_nona_model$Exitus_RITS, mode = "prec_recall", positive = 'X1')

```

## APACHEII + gliukozė 2 faktoriais

```{r echo= FALSE, message=FALSE, warning=FALSE}

model <- train(Exitus_RITS ~ APACHEII + glu_fac, data = analize_nona_model, method = "glm",                trControl = train_control, 
               family = "binomial")

predictions <- predict(model, newdata = analize_nona_model)

confusionMatrix(predictions, analize_nona_model$Exitus_RITS, mode = "prec_recall", positive = 'X1')

summary(model)
```

```{r echo= FALSE, message=FALSE, warning=FALSE, output=FALSE}
analize_nocd <- analize %>%
  select(Atvykimo_glu, Exitus_RITS, CD, APACHEII) %>%
  filter(CD == 0) %>%
  na.omit()

log.glu <- glm(Exitus_RITS ~ APACHEII + Atvykimo_glu, data=analize_nocd, family='binomial')

plot_log <- ggplot(analize_nocd, aes(x=Atvykimo_glu, y=Exitus_RITS)) + geom_point() +
      stat_smooth(method="glm", color="green", se=FALSE, 
                method.args = list(family=binomial))+
  geom_vline(xintercept = 8.63)+
  geom_vline(xintercept = 10)
plot_log
```
